/*!
 * smoothState.js is jQuery plugin that progressively enhances
 * page loads to behave more like a single-page application.
 *
 * @author  Miguel Ángel Pérez   reachme@miguel-perez.com
 * @see     http://smoothstate.com
 *
 */
(function(a){if(typeof module==="object"&&typeof module.exports==="object"){a(require("jquery"),window,document)}else{a(jQuery,window,document)}}(function(f,h,j,c){if(!h.history.pushState){f.fn.smoothState=function(){return this};f.fn.smoothState.options={};return}if(f.fn.smoothState){return}var e=f("html, body"),i=h.console,d={debug:false,anchors:"a",hrefRegex:"",forms:"form",allowFormCaching:false,repeatDelay:500,blacklist:".no-smoothState",prefetch:false,prefetchOn:"mouseover touchstart",prefetchBlacklist:".no-prefetch",cacheLength:0,loadingClass:"is-loading",scroll:true,alterRequest:function(l){return l},alterChangeState:function(m,n,l){return m},onBefore:function(l,m){},onStart:{duration:0,render:function(l){}},onProgress:{duration:0,render:function(l){}},onReady:{duration:0,render:function(m,l){m.html(l)}},onAfter:function(m,l){}},k={isExternal:function(m){var l=m.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);if(typeof l[1]==="string"&&l[1].length>0&&l[1].toLowerCase()!==h.location.protocol){return true}if(typeof l[2]==="string"&&l[2].length>0&&l[2].replace(new RegExp(":("+{"http:":80,"https:":443}[h.location.protocol]+")?$"),"")!==h.location.host){return true}return false},stripHash:function(l){return l.replace(/#.*/,"")},isHash:function(l,n){n=n||h.location.href;var m=(l.indexOf("#")>-1)?true:false,o=(k.stripHash(l)===k.stripHash(n))?true:false;return(m&&o)},translate:function(l){var m={dataType:"html",type:"GET"};if(typeof l==="string"){l=f.extend({},m,{url:l})}else{l=f.extend({},m,l)}return l},shouldLoadAnchor:function(n,m,o){var l=n.prop("href");return(!k.isExternal(l)&&!k.isHash(l)&&!n.is(m)&&!n.prop("target"))&&(typeof o===c||o===""||n.prop("href").search(o)!==-1)},clearIfOverCapacity:function(l,m){if(!Object.keys){Object.keys=function(p){var o=[],n;for(n in p){if(Object.prototype.hasOwnProperty.call(p,n)){o.push(n)}}return o}}if(Object.keys(l).length>m){l={}}return l},storePageIn:function(n,m,p,q,o){var l=f("<html></html>").append(f(p));n[m]={status:"loaded",title:l.find("title").first().text(),html:l.find("#"+q),doc:p,state:o,};return n},triggerAllAnimationEndEvent:function(l,r){r=" "+r||"";var s=0,p="animationstart webkitAnimationStart oanimationstart MSAnimationStart",m="animationend webkitAnimationEnd oanimationend MSAnimationEnd",o="allanimationend",n=function(t){if(f(t.delegateTarget).is(l)){t.stopPropagation();s++}},q=function(t){if(f(t.delegateTarget).is(l)){t.stopPropagation();s--;if(s===0){l.trigger(o)}}};l.on(p,n);l.on(m,q);l.on("allanimationend"+r,function(){s=0;k.redraw(l)})},redraw:function(l){l.height()}},b=function(q){if(q.state!==null){var n=h.location.href,m=f("#"+q.state.id),p=m.data("smoothState"),l=(p.href!==n&&!k.isHash(n,p.href)),o=(event.state!==p.cache[p.href].state);if(l||o){if(o){p.clear(p.href)}p.load(n,false)}}},a=function(m,n){var F=f(m),w=F.prop("id"),B=null,r=false,z={},p={},q=h.location.href,C=function(H){H=H||false;if(H&&z.hasOwnProperty(H)){delete z[H]}else{z={}}F.data("smoothState").cache=z},D=function(J,K){K=K||f.noop;var I=k.translate(J);z=k.clearIfOverCapacity(z,n.cacheLength);if(z.hasOwnProperty(I.url)&&typeof I.data==="undefined"){return}z[I.url]={status:"fetching"};var H=f.ajax(I);H.done(function(L){k.storePageIn(z,I.url,L,w);F.data("smoothState").cache=z});H.fail(function(){z[I.url].status="error"});if(K){H.always(K)}},o=function(){if(B){var H=f(B,F);if(H.length){var I=H.offset().top;e.scrollTop(I)}B=null}},v=function(J){var I="#"+w,H=z[J]?f(z[J].html.html()):null;if(H.length){j.title=z[J].title;F.data("smoothState").href=J;if(n.loadingClass){e.removeClass(n.loadingClass)}n.onReady.render(F,H);F.one("ss.onReadyEnd",function(){r=false;n.onAfter(F,H);if(n.scroll){o()}});h.setTimeout(function(){F.trigger("ss.onReadyEnd")},n.onReady.duration)}else{if(!H&&n.debug&&i){i.warn("No element with an id of "+I+" in response from "+J+" in "+z)}else{h.location=J}}},s=function(L,H,K){var J=k.translate(L);if(typeof H==="undefined"){H=true}if(typeof K==="undefined"){K=true}var N=false,I=false,M={loaded:function(){var O=N?"ss.onProgressEnd":"ss.onStartEnd";if(!I||!N){F.one(O,function(){v(J.url);if(!K){C(J.url)}})}else{if(I){v(J.url)}}if(H){p=n.alterChangeState({id:w},z[J.url].title,J.url);z[J.url].state=p;h.history.pushState(p,z[J.url].title,J.url)}if(I&&!K){C(J.url)}},fetching:function(){if(!N){N=true;F.one("ss.onStartEnd",function(){if(n.loadingClass){e.addClass(n.loadingClass)}n.onProgress.render(F);h.setTimeout(function(){F.trigger("ss.onProgressEnd");I=true},n.onProgress.duration)})}h.setTimeout(function(){if(z.hasOwnProperty(J.url)){M[z[J.url].status]()}},10)},error:function(){if(n.debug&&i){i.log("There was an error loading: "+J.url)}else{h.location=J.url}}};if(!z.hasOwnProperty(J.url)){D(J)}n.onStart.render(F);h.setTimeout(function(){if(n.scroll){e.scrollTop(0)}F.trigger("ss.onStartEnd")},n.onStart.duration);M[z[J.url].status]()},l=function(J){var I,H=f(J.currentTarget);if(k.shouldLoadAnchor(H,n.blacklist,n.hrefRegex)&&!r){J.stopPropagation();I=k.translate(H.prop("href"));I=n.alterRequest(I);D(I)}},A=function(J){var I=f(J.currentTarget);if(!J.metaKey&&!J.ctrlKey&&k.shouldLoadAnchor(I,n.blacklist,n.hrefRegex)){J.stopPropagation();J.preventDefault();if(!G()){t();var H=k.translate(I.prop("href"));r=true;B=I.prop("hash");H=n.alterRequest(H);n.onBefore(I,F);s(H)}}},u=function(J){var H=f(J.currentTarget);if(!H.is(n.blacklist)){J.preventDefault();J.stopPropagation();if(!G()){t();var I={url:H.prop("action"),data:H.serialize(),type:H.prop("method")};r=true;I=n.alterRequest(I);if(I.type.toLowerCase()==="get"){I.url=I.url+"?"+I.data}n.onBefore(H,F);s(I,c,n.allowFormCaching)}}},x=0,G=function(){var H=(n.repeatDelay===null);var I=(parseInt(Date.now())>x);return !(H||I)},t=function(){x=parseInt(Date.now())+parseInt(n.repeatDelay)},y=function(H){if(n.anchors){H.on("click",n.anchors,A);if(n.prefetch){H.find(n.anchors).not(n.prefetchBlacklist).on(n.prefetchOn,null,l)}}if(n.forms){H.on("submit",n.forms,u)}},E=function(){var H=F.prop("class");F.removeClass(H);k.redraw(F);F.addClass(H)};n=f.extend({},f.fn.smoothState.options,n);if(h.history.state===null){p=n.alterChangeState({id:w},j.title,q);h.history.replaceState(p,j.title,q)}else{p={}}k.storePageIn(z,q,j.documentElement.outerHTML,w,p);k.triggerAllAnimationEndEvent(F,"ss.onStartEnd ss.onProgressEnd ss.onEndEnd");y(F);return{href:q,cache:z,clear:C,load:s,fetch:D,restartCSSAnimations:E}},g=function(l){return this.each(function(){var m=this.tagName.toLowerCase();if(this.id&&m!=="body"&&m!=="html"&&!f.data(this,"smoothState")){f.data(this,"smoothState",new a(this,l))}else{if(!this.id&&i){i.warn("Every smoothState container needs an id but the following one does not have one:",this)}else{if((m==="body"||m==="html")&&i){i.warn("The smoothstate container cannot be the "+this.tagName+" tag")}}}})};h.onpopstate=b;f.smoothStateUtility=k;f.fn.smoothState=g;f.fn.smoothState.options=d}));